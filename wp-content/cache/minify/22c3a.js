jQuery(document).ready(function($){if($("#nwm-map-0").length){$(".nwm-wrap").eq(0).parent().wrap("<div id='nwm-outer'>","</div>");}
var flightPath=[],futureFlightPath=[],loadedImageList=[],placeholder=nwmSettings.path+"img/spacer.gif",streetViewVisible=(nwmSettings.streetView==1)?true:false,newMarker=new google.maps.MarkerImage(nwmSettings.path+"/img/marker.png",new google.maps.Size(30,30),new google.maps.Point(0,0),new google.maps.Point(8,8));function initializeGmap(){var mapId,mapType,zoomControlPosition,zoomControlStyle,zoomTo,mapType,zoomLevel;if(nwmSettings.controlPosition=="right"){zoomControlPosition=google.maps.ControlPosition.RIGHT_TOP}else{zoomControlPosition=google.maps.ControlPosition.LEFT_TOP}
if(nwmSettings.controlStyle=="small"){zoomControlStyle=google.maps.ZoomControlStyle.SMALL}else{zoomControlStyle=google.maps.ZoomControlStyle.LARGE}
$(".nomad-world-map").each(function(i){mapId=$(this).attr("id");var nwmLocations="";nwmLocations=window['nwmMap_'+i];mapType=setMapType(nwmLocations);zoomLevel=parseInt(nwmLocations.settings.zoomLevel);if(nwmLocations.settings.contentLocation=="tooltip"){$("#"+mapId+"").parent(".nwm-wrap").addClass("nwm-no-slider");}
$("#"+mapId+"").gmap3({map:{options:{center:[zoomTo],scrollwheel:false,mapTypeControl:false,navigationControl:false,panControl:false,zoom:zoomLevel,mapTypeId:mapType,streetViewControl:streetViewVisible,zoomControlOptions:{style:zoomControlStyle,position:zoomControlPosition}},callback:function(map){if(map.getBounds()){processLocationData($(this),nwmLocations,i);}else{$(this).gmap3({map:{onces:{bounds_changed:function(){processLocationData($(this),nwmLocations,i);}}}});}}}});i++;});}
function setMapType(nwmLocations){var mapType;if(typeof(nwmLocations.settings.mapType!=="undefined")){mapType=nwmLocations.settings.mapType;}else{mapType=nwmSettings.mapType;}
switch(mapType){case"roadmap":mapType=google.maps.MapTypeId.ROADMAP
break;case"satellite":mapType=google.maps.MapTypeId.SATELLITE
break;case"hybrid":mapType=google.maps.MapTypeId.HYBRID
break;case"terrain":mapType=google.maps.MapTypeId.TERRAIN
break;default:mapType=google.maps.MapTypeId.ROADMAP}
return mapType;}
function processLocationData($this,nwmLocations,mapId){var futurePathCount=0,i=0,zoomToIndex=nwmLocations.settings.zoomToIndex,curvedLines=(nwmSettings.curvedLines==1)?true:false;flightPath.length=0;futureFlightPath.length=0;if($("#nwm-map-1").length){mapId=mapId-1;}else{mapId=0;}
for(var key in nwmLocations.locationData){if(nwmLocations.locationData.hasOwnProperty(key)){if(nwmLocations.settings.lines==1){if((nwmLocations.locationData[i].data.future)||(futurePathCount>0)){if(futurePathCount==0){if(i>1){futureFlightPath.push([nwmLocations.locationData[i-1].lat,nwmLocations.locationData[i-1].lng]);}}
if(i==1){flightPath.push([nwmLocations.locationData[i].lat,nwmLocations.locationData[i].lng]);}
futureFlightPath.push([nwmLocations.locationData[i].lat,nwmLocations.locationData[i].lng]);futurePathCount++;}else{flightPath.push([nwmLocations.locationData[i].lat,nwmLocations.locationData[i].lng]);}}
addDestination($this,i,nwmLocations.locationData[i],zoomToIndex,mapId);}
i++;}
if(nwmLocations.settings.lines==1){if(flightPath.length){$this.gmap3({polyline:{options:{strokeColor:nwmSettings.pastLineColor,strokeOpacity:1.0,strokeWeight:2,geodesic:curvedLines,path:flightPath}}});}
if(futureFlightPath.length){$this.gmap3({polyline:{options:{strokeColor:nwmSettings.futureLineColor,strokeOpacity:1.0,strokeWeight:2,geodesic:curvedLines,path:futureFlightPath}}});}}
if(nwmLocations.settings.contentLocation=='slider'){enableControls(mapId);}}
function addDestination($this,i,destination,zoomToIndex,mapId){var $sliderTarget=$("#nwm-map-"+mapId+"").next().find("ul");$this.gmap3({marker:{latLng:[destination.lat,destination.lng],options:{icon:newMarker},events:{click:function(marker){$(this).gmap3({clear:"overlay"});}},callback:function(marker){var markerData={};if(!$("#nwm-map-"+mapId+"").parent(".nwm-wrap").hasClass("nwm-no-slider")){var destinationHtml,content=destination.data.content;markerData=getMarkerData(destination,nwmSettings,'slider');content=content+markerData.readMore;if(destination.data.arrival){if(destination.data.departure){destinationHtml='<li data-id="'+destination.data.nwm_id+'">'+markerData.thumb+'<h2>'+markerData.title+'</h2><p class="nwm-travel-schedule"><span>'+destination.data.arrival+'</span><span> - '+destination.data.departure+'</span></p><p>'+content+'</p></li>';}else{destinationHtml='<li data-id="'+destination.data.nwm_id+'">'+markerData.thumb+'<h2>'+markerData.title+'</h2><p class="nwm-travel-schedule"><span>'+destination.data.arrival+'</span></p><p>'+content+'</p></li>';}}else{destinationHtml='<li data-id="'+destination.data.nwm_id+'">'+markerData.thumb+'<h2>'+markerData.title+'<span>'+destination.data.date+'</span></h2><p>'+content+'</p></li>';}
$sliderTarget.append(destinationHtml);$sliderTarget.find("li").eq(i).bind("mouseover",function(){$this.gmap3("get").panTo(marker.position);if(!$("#nwm-map-"+mapId+".marker-"+i+"").length){$this.gmap3({clear:"overlay"},{overlay:{latLng:marker.position,options:{content:"<div class='marker-style marker-"+i+"'>"+destination.data.location+"</div>",offset:{x:11,y:-15}}}});}});if(i==zoomToIndex){$sliderTarget.find("li:eq("+zoomToIndex+")").addClass("nwm-active-destination").mouseover();if(!$sliderTarget.find(".nwm-active-destination span.nwm-thumb").length){imageLoader($sliderTarget);}}
if((zoomToIndex==-1)&&(i==0)){$("#nwm-map-"+mapId+" .nwm-destination-list li:first-child").addClass("nwm-active-destination").mouseover();}}else{if(i==zoomToIndex){markerData=getMarkerData(destination,nwmSettings,"tooltip");markerContent='<div class="marker-style marker-'+i+'"><div class="nwm-marker-wrap">'+markerData.thumb+'<div class="marker-txt"><h2>'+markerData.title+'</h2><p>'+markerData.date+markerData.readMore+'</p></div></div></div>';if(nwmSettings.hideTooltip!=1){$this.gmap3("get").panTo(marker.position);$this.gmap3({clear:"overlay"},{overlay:{latLng:marker.position,options:{content:markerContent,offset:{x:11,y:-15}}}});}}}},events:{mouseover:function(marker){var markerContent;if(!$("#nwm-map-"+mapId+"").parent(".nwm-wrap").hasClass("nwm-no-slider")){$sliderTarget.find("li").removeClass();$sliderTarget.find("li").eq(i).addClass("nwm-active-destination");$sliderTarget.find(".nwm-active-destination img").attr("src",placeholder);if(!$sliderTarget.find(".nwm-active-destination span.nwm-thumb").length){imageLoader($sliderTarget);}
markerContent="<div class='marker-style marker-"+i+"'>"+destination.data.location+"</div>";}else{markerData=getMarkerData(destination,nwmSettings,'tooltip');markerContent='<div class="marker-style marker-'+i+'"><div class="nwm-marker-wrap">'+markerData.thumb+'<div class="marker-txt"><h2>'+markerData.title+'</h2><p>'+markerData.date+markerData.readMore+'</p></div></div></div>';}
$(this).gmap3({clear:"overlay"},{overlay:{latLng:marker.getPosition(),options:{content:markerContent,offset:{x:11,y:-15}}}});}}}});}
function getMarkerData(destination,nwmSettings,contentType){var markerData={},circleClass=checkCircleClass(nwmSettings.thumbCircles),thumbHtml="",titleHtml="",spanDate="",readMoreLabel="",readMoreHtml="";if(destination.data.arrival){spanDate="<span>"+destination.data.arrival+" - "+destination.data.departure+"</span>";}else{spanDate="<span>"+destination.data.date+"</span>";}
if(contentType=='tooltip'){if(destination.data.thumb!=null){thumbHtml='<img class="nwm-thumb nwm-marker-img '+circleClass+'" src="'+destination.data.thumb+'" width="64" height="64" />';}else{thumbHtml='';}}else{if(destination.data.thumb!=null){thumbHtml='<img class="nwm-thumb '+circleClass+'" data-src="'+destination.data.thumb+'" src="'+placeholder+'" width="64" height="64" />';}else{thumbHtml='<div><span class="nwm-thumb '+circleClass+'" /></span></div>';}}
titleHtml=checkHeaderFormat(destination.data.url,destination.data.title,destination.data.location);if((destination.data.url.length>0)&&(nwmSettings.readMore==1)){if(typeof(nwmSettings.readMoreLabel)!=="undefined"){readMoreLabel=nwmSettings.readMoreLabel;}else{readMoreLabel="Read more";}
readMoreHtml="<a class='nwm-read-more' href='"+destination.data.url+"'>"+readMoreLabel+"</a>";}
if((destination.data.url.length>0)&&(nwmSettings.locationHeader==1)){titleHtml=titleHtml+"<span>"+destination.data.location+"</span>";}
markerData={circleClass:circleClass,thumb:thumbHtml,date:spanDate,readMore:readMoreHtml,title:titleHtml};return markerData;}
function imageLoader($map){var $li=$map.find(".nwm-active-destination"),img=new Image(),imgTarget=$li.find(".nwm-thumb"),imgSrc=$li.find(".nwm-thumb").data("src"),id=$li.data("id"),preloader='<img class="nwm-preloader" id="nwm-preload-img-'+id+'" src="'+nwmSettings.path+'admin/img/ajax-loader.gif" />';if($.inArray(id,loadedImageList)===-1){$li.append(preloader);img.onload=function(){$("#nwm-preload-img-"+id).remove();imgTarget.attr("src",this.src);loadedImageList.push(id);};img.src=imgSrc;}else{imgTarget.attr("src",imgSrc);}}
function checkHeaderFormat(markerUrl,markerTitle,destination){var title;if(markerUrl){title="<a href='"+markerUrl+"'>"+markerTitle+"</a>";}else{if(markerTitle){title=markerTitle;}else{title=destination;}}
return title;}
function checkCircleClass(thumbCircles){var circleClass;if(thumbCircles==1){circleClass="nwm-circle";}else{circleClass="";}
return circleClass;}
function enableControls(mapId){var $map=$("#nwm-map-"+mapId+"").next();$map.find(".nwm-forward").on("click",function(){var currentDestination=$map.find(".nwm-active-destination");if(currentDestination.next().length){currentDestination.removeClass().next().addClass("nwm-active-destination").mouseover();}else{currentDestination.removeClass("nwm-active-destination");$map.find("li:first-child").addClass("nwm-active-destination").mouseover();}
if(!$map.find(".nwm-active-destination span.nwm-thumb").length){imageLoader($map);}});$map.find(".nwm-back").on("click",function(){var currentDestination=$map.find(".nwm-active-destination");if(currentDestination.prev().length){currentDestination.removeClass().prev().addClass("nwm-active-destination").mouseover();}else{currentDestination.removeClass("nwm-active-destination");$map.find("li:last-child").addClass("nwm-active-destination").mouseover();}
if(!$map.find(".nwm-active-destination span.nwm-thumb").length){imageLoader($map);}});}
if(!$("#nwm-map-1").length){$(document).keydown(function(eventObject){if(eventObject.which==37){$(".nwm-back").trigger("click");}else if(eventObject.which==39){$(".nwm-forward").trigger("click");}});}
google.maps.event.addDomListener(window,"load",initializeGmap);});